# Database Actions - ORDS

## Introduction

This lab explains how to install Oracle Rest Data Services (ORDS) on a VM or compute instance running Linux, enable a schema, and log in to the Database Actions console.

The lab covers the preparation and the steps for installing *ORDS 24.1*.

## Get the installers

Download these using a web browser or from a terminal using CLI.

1. **Java 17**
1. **ORDS 24.1**
1. **Oracle Database**
1. **Sample schemas 23c**

	----
	## Links and steps to download

	The version of these packages depends on the ORDS version that you want to install. 

	1. **Java 17**: Get the installer, *`jdk-17_linux-x64_bin.rpm`*.

		 - From the [download site](https://www.oracle.com/in/java/technologies/downloads/#java17) or using CLI - 

			```
			$ <copy>wget https://download.oracle.com/java/17/latest/jdk-17_linux-x64_bin.rpm</copy>
			```

	1. **ORDS 24.1**: Get the installer, *`ords-24.1.0.108.0942.zip`* dated April 23, 2024.

		 - From the [download site](https://www.oracle.com/technologies/appdev/rest-data-services-downloads-24.1.html) or using CLI - 

			```
			$ <copy>wget https://download.oracle.com/otn_software/java/ords/ords-24.1.0.108.0942.zip</copy>
			```

		> Oracle REST Data Services JDBC driver is not required.

	1. **Oracle Database**: Get the installer for the required database version, for example, 21c *`LINUX.X64_213000_db_home.zip`*. 

		 - For example,  

			```
			$ <copy>https://www.oracle.com/database/technologies/oracle21c-linux-downloads.html#license-lightbox</copy>
			```

		> Requires an Oracle account or SSO to download.

	1. **Sample schemas 23c**: Get the source code file, `db-sample-schemas-23.3.zip`

		 - From the GitHub [download site](https://github.com/oracle-samples/db-sample-schemas/releases) or using CLI - 

			```
			$ <copy>wget https://github.com/oracle-samples/db-sample-schemas/archive/refs/tags/v23.3.zip</copy>
			```

## Prepare for installation

1. Install Java
1. Extract the ORDS installer
1. Install Oracle Database
1. Check PDB details

	----
	## 1. Install Java

	1. Verify that the system has *Java 17* installed and the *`PATH`* variable set up. 

		```
		$ <copy>java -version</copy>
		```

		```
		java version "17.0.12" 20YY-MM-DD LTS
		Java(TM) SE Runtime Environment (build 17.0.12+8-LTS-286)
		Java HotSpot(TM) 64-Bit Server VM (build 17.0.12+8-LTS-286, mixed mode, sharing)
		```

		If it displays an older version of Java, for example, 1.0.8 or says Java is not installed, then install or upgrade Java. Skip the next step if Java 17 is already installed.

	1. Go to the folder that contains the Java RPM installer and run the installer. 

		```
		$ <copy>rpm -ivh jdk-17_linux-x64_bin.rpm</copy>
		```

		Here,

		 - *i* - installs the package
		 - *v* - stands for verbose and displays the detailed output
		 - *h* - prints hash marks to indicate the progress

	Open a new terminal and verify the Java version.

	----
	## 2. Extract the ORDS installer

	1. Create a folder *`ords`* and a subfolder *`conf`* where you want to install, for example, under `~/Downloads`.

		```
		$ <copy>mkdir -p ~/Downloads/ords/conf</copy>
		```

	1. Extract the ORDS installer (`*.zip`) into `~/Download/ords`.

		```
		$ unzip -q ords-24.1.0.108.0942.zip -d ~/Downloads/ords
		```

	----
	## 3. Install Oracle Database

	Download and install Oracle Database, for example 21c (21.3) - *`LINUX.X64_213000_db_home.zip`*, if not already installed. 

	Refer [this lab](https://manish-garodia.github.io/mg-playground/topic-title/oracle-db/).

	Skip this if Oracle Database is already installed. 

	----
	## 4. Check PDB details

	Check the listener configuration to know the PDB service name and the port number. 
	
	1. Set the environment variables, `$ORACLE_HOME` and `$ORACLE_SID`.
	
	1. Go to `$ORACLE_HOME/bin` and view the listener status.

		```
		[ORACLE_HOME/bin]$ <copy>./lsnrctl status</copy>
		```

	 - It returns listener configuration and displays the PDB service name, for example, *`orclpdb.us.oracle.com`* and the port, for example, `1522` where the PDB service is running.

		> **Note**: If the listener does not know of the PDB, then ORDS installation exists with an error - <i>Listener refused the connection, listener does not know of the service `[pdb-name]`</i>. 

		----
		## Register PDB with Listener

		Add PDB details to `tnsnames.ora`, restart the database, and open all PDBs.

		1. 	Go to the location under `$ORACLE_BASE` where the network configuration files reside. 

		1. 	Check the contents of `listener.ora`, `sqlnet.ora`, and `tnsnames.ora`.

			- *`listener.ora`* - 

				```
				$ <copy>cat listener.ora</copy>
				```

				```
				# listener.ora Network Configuration File: /u01/app/oracle/homes/OraDB21Home1/network/admin/listener.ora
				# Generated by Oracle configuration tools.

				LISTENER=
				  (DESCRIPTION_LIST =
					(DESCRIPTION =
					  (ADDRESS = (PROTOCOL = TCP)(HOST = [hostname])(PORT = 1522))
					  (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1522))
					)
				  )
				```

			- *`sqlnet.ora`* - 

				```
				$ <copy>cat sqlnet.ora</copy>
				```

				```
				# sqlnet.ora Network Configuration File: /u01/app/oracle/homes/OraDB21Home1/network/admin/sqlnet.ora
				# Generated by Oracle configuration tools.

				NAMES.DIRECTORY_PATH= (TNSNAMES, EZCONNECT)
				```

			- *`tnsnames.ora`* - 

				```
				$ <copy>cat tnsnames.ora</copy>
				```

				```
				# tnsnames.ora Network Configuration File: /u01/app/oracle/database/homes/OraDB21Home1/network/admin/tnsnames.ora
				# Generated by Oracle configuration tools.

				LISTENER_ORCL =
				  (ADDRESS = (PROTOCOL = TCP)(HOST = [hostname])(PORT = 1522))


				ORCL =
				  (DESCRIPTION =
					(ADDRESS = (PROTOCOL = TCP)(HOST = [hostname])(PORT = 1522))
					(CONNECT_DATA =
					  (SERVER = DEDICATED)
					  (SERVICE_NAME = orcl.us.oracle.com)
					)
				  )

				ORCLPDB =
				  (DESCRIPTION =
					(ADDRESS = (PROTOCOL = TCP)(HOST = [hostname])(PORT = 1522))
					(CONNECT_DATA =
					  (SERVER = DEDICATED)
					  (SERVICE_NAME = orclpdb.us.oracle.com)
					)
				  )
				```

				If `tnsnames.ora` does not contain the PDB, add the PDB.

				A. Open `tnsnames.ora` in a text editor. 

				```
				$ <copy>vi tnsnames.ora</copy>
				```

				B. Press *`i`* to enter into the **Insert** mode. 

				C. Add PDB information similar to this. Update the port number, if required.

				```
				ORCLPDB =
				  (DESCRIPTION =
					(ADDRESS = (PROTOCOL = TCP)(HOST = [hostname])(PORT = 1522))
					(CONNECT_DATA =
					  (SERVER = DEDICATED)
					  (SERVICE_NAME = orclpdb.us.oracle.com)
					)
				  )
				```

				Press **Esc** followed by **:wq** to save and close the file.

		1. Set the environment variables `$ORACLE_HOME` and `$ORACLE_SID`. Log in to the SQL prompt as `SYSDBA`. 

			```
			[ORACLE_HOME/bin]$ <copy>sqlplus / as sysdba</copy>
			```

		1. From the SQL prompt, close the database. 

			```
			SQL> <copy>shutdown immediate</copy>
			```

			```
			Database closed.
			Database dismounted.
			ORACLE instance shut down.
			```

		1. Start the database.

			```
			SQL> <copy>startup</copy>
			```

			```
			ORACLE instance started.

			Total System Global Area 1.0033E+10 bytes
			Fixed Size		        9696192 bytes
			Variable Size		 1509949440 bytes
			Database Buffers	 8489271296 bytes
			Redo Buffers		   23855104 bytes
			Database mounted.
			```

		1. Open the PDB or all PDBs.

			```
			SQL> <copy>alter pluggable database all open;</copy>

			Pluggable database altered.
			```

		Now, check the listener status again. 

		```
		[ORACLE_HOME/bin]$ <copy>./lsnrctl status</copy>
		```

		This time the listener configuration shows the PDB service is registered and running on the specified port. Note the PDB service name and the port number.

		> **Important**: If listener does not show `orcl` and the PDB service, it may be because the listener has been running for a previously installed database, and for 21c, the network configuration files are not created. Hence, create the files manually - `listener.ora`, `tnsnames.ora`, and `sqlnet.ora` in the Oracle Base directory `$ORACLE_BASE/homes/OraDB21Home1/network/admin` and copy the service names. Restart the database and open the PDB to let the listener know of the services.

## ORDS Installation

- Select the ORDS version to install. 

	----
	## Install *ORDS 24.1* - Interactive

	These steps will install ORDS in the PDB.

	1. Go to the `ords/bin` directory where you extracted the installer. 

		```
		$ <copy>cd ~/Downloads/ords/bin</copy>
		```

	1. Start the interactive installation of ORDS.

		```
		$ <copy>ords --config ~/Downloads/ords/conf install</copy>
		```

		The installer checks the ORDS configuration folder. 

		```
		20YY-MM-DDT17:52:03.836Z INFO        Your configuration folder /home/oracle/Downloads/ords/conf is located in ORDS product folder.  Oracle recommends to use a different configuration folder.

		ORDS: Release 24.1 Production on Thu MMM DD 17:52:03 20YY

		Copyright (c) 2010, 2024, Oracle.

		Configuration:
		  /home/oracle/Downloads/ords/conf

		The configuration folder /home/oracle/Downloads/ords/conf does not contain any configuration files.

		Oracle REST Data Services - Interactive Install
		```

	1. Specify the service name where ORDS will be installed. 

		```
		  Enter a number to select the TNS net service name to use or specify the database connection
			[1] ORCL         SERVICE_NAME=orcl.us.oracle.com                             
			[2] ORCLPDB      SERVICE_NAME=orclpdb.us.oracle.com                          
			[S] Specify the database connection
		```

		 - If the PDB service is displayed, select the corresponding number, for example *2*. 

		 - If the PDB service is not displayed, then enter *S* to specify connection details for the PDB, such as, PDB service name, port number, and so on.

			```
			database connection type: Basic
			hostname: localhost
			listen port: 1522
			database service name: orclpdb.us.oracle.com
			```

	1. Enter the administrative user name, for example *`SYS`*, and the `SYSDBA` password. 

		```
		  Provide database user name with administrator privileges.
			Enter the administrator username: sys
		  Enter the database password for SYS AS SYSDBA: 
		```

		The installer checks whether ORDS is already installed. 

		```
		Retrieving information.
		ORDS is not installed in the database. ORDS installation is required.
		```

	1. You can update the specified values or enter *A* to continue the installation with the defaults.

		```
		  Enter a number to update the value or select option A to Accept and Continue
			[1] Connection Type: TNS
			[2] TNS Connection: TNS_NAME=ORCLPDB TNS_FOLDER=/u01/app/oracle/database/homes/OraDB21Home1/network/admin
				   Administrator User: SYS AS SYSDBA
			[3] Database password for ORDS runtime user (ORDS_PUBLIC_USER): <generate>
			[4] ORDS runtime user and schema tablespaces:  Default: SYSAUX Temporary TEMP
			[5] Additional Feature: Database Actions
			[6] Configure and start ORDS in Standalone Mode: Yes
			[7]    Protocol: HTTP
			[8]       HTTP Port: 8080
			[A] Accept and Continue - Create configuration and Install ORDS in the database
			[Q] Quit - Do not proceed. No changes
		  Choose [A]: 
		```

		- The installer proceeds with the installation.

			----
			## View details

			```
			The setting named: db.connectionType was set to: tns in configuration: default
			The setting named: db.tnsAliasName was set to: ORCLPDB in configuration: default
			The setting named: db.tnsDirectory was set to: /u01/app/oracle/database/homes/OraDB21Home1/network/admin in configuration: default
			The setting named: db.username was set to: ORDS_PUBLIC_USER in configuration: default
			The setting named: db.password was set to: ****** in configuration: default
			The setting named: feature.sdw was set to: true in configuration: default
			The global setting named: database.api.enabled was set to: true
			The setting named: restEnabledSql.active was set to: true in configuration: default
			The global setting named: standalone.http.port was set to: 8080
			The global setting named: standalone.static.context.path was set to: /ords
			The global setting named: standalone.doc.root was set to: /home/oracle/Downloads/ords/conf/global/doc_root
			The setting named: security.requestValidationFunction was set to: ords_util.authorize_plsql_gateway in configuration: default
			2024-07-18T17:56:12.660Z INFO        Created folder /home/oracle/Downloads/ords/bin/logs
			2024-07-18T17:56:12.661Z INFO        The log file is defaulted to the current working directory located at /home/oracle/Downloads/ords/bin/logs
			2024-07-18T17:56:12.751Z INFO        Installing Oracle REST Data Services version 24.1.0.r1080942 in ORCLPDB
			2024-07-18T17:56:14.261Z INFO        ... Verified database prerequisites
			2024-07-18T17:56:14.843Z INFO        ... Created Oracle REST Data Services proxy user
			2024-07-18T17:56:15.347Z INFO        ... Created Oracle REST Data Services schema
			2024-07-18T17:56:16.019Z INFO        ... Granted privileges to Oracle REST Data Services
			2024-07-18T17:56:18.828Z INFO        ... Created Oracle REST Data Services database objects
			2024-07-18T17:56:29.247Z INFO        Completed installation for Oracle REST Data Services version 24.1.0.r1080942. Elapsed time: 00:00:16.408 

			2024-07-18T17:56:29.249Z INFO        Log file written to /home/oracle/Downloads/ords/bin/logs/ords_install_2024-07-18_175612_66127.log
			2024-07-18T17:56:29.414Z INFO        HTTP and HTTP/2 cleartext listening on host: 0.0.0.0 port: 8080
			2024-07-18T17:56:29.431Z INFO        Disabling document root because the specified folder does not exist: /home/oracle/Downloads/ords/conf/global/doc_root
			2024-07-18T17:56:29.432Z INFO        Default forwarding from / to contextRoot configured.
			2024-07-18T17:56:32.100Z INFO        Configuration properties for: |default|lo|
			db.password=******
			db.tnsAliasName=ORCLPDB
			conf.use.wallet=true
			security.requestValidationFunction=ords_util.authorize_plsql_gateway
			standalone.static.context.path=/ords
			database.api.enabled=true
			db.username=ORDS_PUBLIC_USER
			standalone.http.port=8080
			restEnabledSql.active=true
			resource.templates.enabled=false
			feature.sdw=true
			config.required=true
			db.connectionType=tns
			standalone.doc.root=/home/oracle/Downloads/ords/conf/global/doc_root
			db.tnsDirectory=/u01/app/oracle/database/homes/OraDB21Home1/network/admin

			2024-07-18T17:56:32.102Z WARNING     *** jdbc.MaxLimit in configuration |default|lo| is using a value of 10, this setting may not be sized adequately for a production environment ***
			2024-07-18T17:56:32.102Z WARNING     *** jdbc.InitialLimit in configuration |default|lo| is using a value of 10, this setting may not be sized adequately for a production environment ***
			2024-07-18T17:56:38.828Z INFO        
			```

		On successful completion, the installer displays these indicators: 
		 - *`VALID`* 
		 - `Oracle REST Data Services initialized`

		```
		Mapped local pools from /home/oracle/Downloads/ords/conf/databases:
		  /ords/                          => default                    => VALID     


		2024-07-18T17:56:38.930Z INFO        Oracle REST Data Services initialized
		Oracle REST Data Services version : 24.1.0.r1080942
		Oracle REST Data Services server info: jetty/10.0.20
		Oracle REST Data Services java info: Java HotSpot(TM) 64-Bit Server VM 17.0.12+8-LTS-286
		```

		> **Note**: If the response at the end shows *`INVALID`*, then the Database Action login page does not open. 

	Congratulations! You have installed ORDS in the PDB. Leave the terminal and the ORDS service running to access the Database Actions login page.

	Enable a schema in the PDB, if not already done, and use its credentials to log in to the Database Actions console. 

## Postinstallation tasks

 - Install a schema
 - Enable REST services for the schema
 - Stop ORDS and restart

	> If you already have the schema installed or the user created in the PDB, you can enable that schema. On the other hand, you can install a new schema in the PDB. 

	----
	## Install a schema

	These steps will install the `HR` schema in the PDB.

	1. Set the environment variables `$ORACLE_HOME` and `$ORACLE_SID`. Log in to the SQL prompt as `SYSDBA`. 

		```
		[ORACLE_HOME/bin]$ <copy>sqlplus / as sysdba</copy>
		```

	1. Change the container to PDB.

		```
		SQL> <copy>alter session set container=orclpdb;</copy>
		```

	1. Install the required schema, for example, the *`hr`* schema. 

		**Syntax**

		```
		SQL> @ [path-to-schema.sql]
		```

		Example

		```
		SQL> <copy>@ /home/oracle/Downloads/db-sample-schemas-23.3/human_resources/hr_install.sql</copy>
		```

		```
		Thank you for installing the Oracle Human Resources Sample Schema.
		This installation script will automatically exit your database session
		at the end of the installation or if any error is encountered.
		The entire installation will be logged into the 'hr_install.log' log file.
		```

	1.	Specify a password for the user and select the tablespace. 

		```
		Enter a password for the user HR: oracle
		Enter a tablespace for HR [USERS]: 
		```

		- If the schema already exists, enter `YES` to overwrite it. 

			```
			Do you want to overwrite the schema, if it already exists? [YES|no]: Enter YES
			```

			## View details

			```
			******  Creating REGIONS table ....

			Table created.


			Index created.


			Table altered.

			******  Creating COUNTRIES table ....

			Table created.


			Table altered.

			******  Creating LOCATIONS table ....

			Table created.


			Index created.


			Table altered.


			Sequence created.

			******  Creating DEPARTMENTS table ....

			Table created.


			Index created.


			Table altered.


			Sequence created.

			******  Creating JOBS table ....

			Table created.


			Index created.


			Table altered.

			******  Creating EMPLOYEES table ....

			Table created.


			Index created.


			Table altered.


			Table altered.


			Sequence created.

			******  Creating JOB_HISTORY table ....

			Table created.


			Index created.


			Table altered.

			******  Creating EMP_DETAILS_VIEW view ...

			View created.

			******  Creating indexes ...

			Index created.


			Index created.


			Index created.


			Index created.


			Index created.


			Index created.


			Index created.


			Index created.


			Index created.


			Index created.


			Index created.

			******  Adding table column comments ...

			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Comment created.


			Session altered.

			****** Populating REGIONS table ....

			PL/SQL procedure successfully completed.

			****** Populating COUNTRIES table ....

			PL/SQL procedure successfully completed.

			****** Populating LOCATIONS table ....

			PL/SQL procedure successfully completed.

			****** Populating DEPARTMENTS table ....

			Table altered.


			PL/SQL procedure successfully completed.

			****** Populating JOBS table ....

			PL/SQL procedure successfully completed.

			****** Populating EMPLOYEES table ....

			PL/SQL procedure successfully completed.

			****** Populating JOB_HISTORY table ....

			PL/SQL procedure successfully completed.


			Commit complete.


			Table altered.


			Procedure created.


			Trigger created.


			Trigger altered.


			Procedure created.


			Trigger created.


			Commit complete.


			Installation
			-------------
			Verification:

			Table         provided     actual
			----------- ---------- ----------
			regions              5          5
			countries           25         25
			departments         27         27
			locations           23         23
			employees          107        107
			jobs                19         19
			job_history         10         10

			Thank you!
			--------------------------------------------------------
			The installation of the sample schema is now finished.
			Please check the installation verification output above.

			You will now be disconnected from the database.

			Thank you for using Oracle Database!

			Disconnected from Oracle Database 21c Enterprise Edition Release 21.0.0.0.0 - Production
			Version 21.3.0.0.0
			```

	You have installed the schema in the PDB.

	----
	## Enable REST services for the schema

	Connect to the PDB as the specific user and enable the schema.

	1. Go to the SQL prompt.

		```
		[ORACLE_HOME/bin]$ <copy>sqlplus / as sysdba</copy>
		```

	1. Change the container to PDB.

		```
		SQL> <copy>alter session set container=orclpdb;</copy>

		Session altered.
		```

	1. Connect as the *`HR`* user.

		```
		SQL> <copy>conn HR/oracle@orclpdb</copy>

		Connected.
		```

	1. Enable REST services for the `HR` schema. 

		```
		<copy>
		DECLARE
		  PRAGMA AUTONOMOUS_TRANSACTION;
		BEGIN 
			ORDS.ENABLE_SCHEMA(p_enabled => TRUE,
							   p_schema => 'HR',
							   p_url_mapping_type => 'BASE_PATH',
							   p_url_mapping_pattern => 'hr',
							   p_auto_rest_auth => FALSE);
			commit;
		END;
		/
		</copy>
		```

		```
		  2  3    4    5    6    7    8    9   10   11   12  
		PL/SQL procedure successfully completed.
		```

	You can now log in to the Database Actions console as the `HR` user in a web browser.

	----
	## Stop ORDS and restart

	To stop ORDS:
	1. Go to the terminal where ORDS is running.

	1. Press **CTRL + C** or close the terminal window.

	To start ORDS again:
	1. Go to the `ords/bin` folder. 

	1. Run this.

		```
		[~/Downloads/ords/bin]$ <copy>ords --config ~/Downloads/ords/conf serve</copy>
		```

## Log in to the Database Actions console

Access the Database Actions login page in a web browser using the login URL.    
For example, `http://[hostname]:8080/ords/sql-developer `.

![Database Actions login](./images/db-actions-01-signin-page.png " ")

**Problem**   
The login page does not open? 

Check if:
 - The database is up and running.
 - The PDB is open.
 - The listener is up and running.
 - ORDS services are running.

## Acknowledgments

 - **Author** - [](include:author)
 - **Created on** - July 19, (Fri) 2024
 - **Last updated on** - July 24, (Wed) 2024
 - **Questions/Feedback?** - Blame [](include:profile)
